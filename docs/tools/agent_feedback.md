# Agent Feedback Log（自我改进记录）

目的：把“这次 agent 哪里做错/哪里做得好”变成可复用规则，让下一次表现更稳定。
使用方式：每次任务结束后，用 3–8 分钟填一条记录；若产生新规则，需同步更新根目录 agent.md。

---

## 记录模板（每次新增一条，复制下面块即可）

### [YYYY-MM-DD] 任务：<简短任务名>
**上下文/目标（1-2 句）**
- 想完成什么？验收标准是什么？

**实际结果**
- ✅ 做对了什么：
- ❌ 做错了什么 / 漏了什么：
- ⚠️ 有风险或不确定的地方：

**根因分析（选 1-3 个最主要的）**
- [ ] 没有先读 prd.md / agent.md
- [ ] 误解范围（做了 PRD Out of scope 的事，或漏了 Must-have）
- [ ] 逻辑实现偏差（GST 计算/汇总/导入规则不一致）
- [ ] 数据安全问题（缺 user_id 过滤 / RLS 未考虑）
- [ ] 输出不符合要求（缺少文件清单/测试方法）
- [ ] 工程质量不足（类型松散/无测试/重复代码）
- [ ] UI/UX 不符合预期（移动端不好用/提示不清）
- [ ] 其他：<写明>

**可执行的新规则（必须具体、可检查）**
- Rule 1:
- Rule 2:
- Rule 3:

**示例（可选，但强烈建议）**
- ✅ 好例子：
- ❌ 坏例子：

**需要同步更新到 agent.md 的内容**
- [ ] 是（写出要加到 agent.md 的章节与文本）
- [ ] 否

**下次任务的“启动提醒”（一句话）**
- 例如：先跑测试 + 再改代码；先做小范围 PR；先验 RLS；等等

---

### [2025-11-26] 任务：Transaction 编辑页软删除
**上下文/目标（1-2 句）**
- 在交易编辑页新增删除按钮，执行软删除（deleted_at）并确认，删除后返回列表提示删除成功，列表隐藏已删除交易。

**实际结果**
- ✅ 软删除改为更新 deleted_at 并过滤列表，编辑页删除按钮含 confirm 与成功跳转提示；通过 lint。
- ❌ 暂无。
- ⚠️ 依赖 Supabase 表含 deleted_at 字段且 RLS 继续按 user_id 生效。

**根因分析（选 1-3 个最主要的）**
- [ ] 没有先读 prd.md / agent.md
- [ ] 误解范围（做了 PRD Out of scope 的事，或漏了 Must-have）
- [ ] 逻辑实现偏差（GST 计算/汇总/导入规则不一致）
- [ ] 数据安全问题（缺 user_id 过滤 / RLS 未考虑）
- [ ] 输出不符合要求（缺少文件清单/测试方法）
- [ ] 工程质量不足（类型松散/无测试/重复代码）
- [ ] UI/UX 不符合预期（移动端不好用/提示不清）
- [ ] 其他：暂未发现问题

**可执行的新规则（必须具体、可检查）**
- Rule 1: 删除交易时更新 `deleted_at`，所有列表/查询默认过滤掉已删除记录。
- Rule 2: 交易删除在 UI 层必须二次确认并在成功后反馈（toast/提示+跳转）。
- Rule 3: （暂无）

**示例（可选，但强烈建议）**
- ✅ 好例子：编辑页 Delete 按钮 -> confirm -> 软删除 -> `/transactions?deleted=1` 提示。
- ❌ 坏例子：直接调用 `delete()` 物理删除或无确认直接隐藏。

**需要同步更新到 agent.md 的内容**
- [x] 是（新增删除相关规则）
- [ ] 否

**下次任务的“启动提醒”（一句话）**
- 先检查 PRD/agent 是否要求软删除/RLS，再设计删除流程。

---

## 汇总区（每月/每阶段更新一次）

### 常见错误 Top 5（从记录里提炼）
1.
2.
3.
4.
5.

### 最有效的规则 Top 5（最能减少返工的）
1.
2.
3.
4.
5.

### 待补强的自动化（把验收标准变成可测试）
- [ ] GST 计算单测
- [ ] CSV 导入解析单测
- [ ] 汇总页 e2e（关键路径）
- [ ] RLS 验证脚本/检查清单
